import{k as m,r as v,c as l,b as r,f as j,e,t as d,l as B,F as y,h as w,n as M,p as F,q as E,s as R,x as I,W as A,y as U,w as N,d as P,g as V,v as L,T as Y,u as z}from"./app-DROPElbh.js";import{A as O}from"./AppMain-CjcZ16YI.js";import{h as q}from"./html2pdf-CYDjOxTG.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"p-4 space-y-6 overflow-auto"},G={key:0,class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},J={class:"text-2xl font-bold text-blue-800"},K={id:"calendario-pdf",class:"overflow-x-auto rounded-xl shadow ring-1 ring-blue-200 bg-white p-4"},Q={class:"min-w-full border-collapse text-sm text-gray-800"},X={class:"bg-blue-50 border-b border-blue-200 text-xs uppercase sticky top-0 z-10"},Z={class:"px-4 py-2 text-gray-600 font-semibold whitespace-nowrap"},ee={class:"px-4 py-2 text-gray-600 whitespace-nowrap"},te={class:"px-4 py-2 text-gray-600 whitespace-nowrap"},se=["title"],ae={class:"px-4 py-2 text-center font-bold text-blue-700"},oe={class:"mt-8 flex justify-center items-center space-x-1 text-sm sm:text-base font-medium"},ne=["disabled"],re=["onClick"],le=["disabled"],T=3,ie={__name:"CalendarioAsistencia",props:{trabajadores:Array,embarcaciones:Array,mes:Number,a√±o:Number},setup(C){const n=C,g=t=>t.toString().padStart(2,"0"),h=m(()=>{const t=new Date(n.a√±o,n.mes,0);return Array.from({length:t.getDate()},(s,a)=>a+1)}),b=m(()=>new Date(n.a√±o,n.mes-1).toLocaleString("default",{month:"long"}).toUpperCase()),c=t=>({D:"bg-green-100 text-green-800 border-green-300",TR:"bg-blue-100 text-blue-800 border-blue-300",L:"bg-yellow-100 text-yellow-800 border-yellow-300",F:"bg-red-100 text-red-800 border-red-300"})[t]||"bg-gray-100 text-gray-400 border-gray-300",x=(t,s)=>{var u;const a=`${n.a√±o}-${g(n.mes)}-${g(s)}`;return((u=t.asistencias)==null?void 0:u[a])||null},k=t=>h.value.reduce((s,a)=>{const u=`${n.a√±o}-${g(n.mes)}-${g(a)}`;return(t==null?void 0:t[u])==="TR"?s+1:s},0),f=v(!1),D=async()=>{f.value=!0,await E();const t=document.getElementById("calendario-pdf"),s={margin:-.1,filename:`calendario-${new Date().toISOString().slice(0,10)}.pdf`,image:{type:"jpeg",quality:.8},html2canvas:{scale:2,useCORS:!0,backgroundColor:"#fff"},jsPDF:{unit:"in",format:[8.5,16],orientation:"landscape"},pagebreak:{mode:["avoid-all","css","legacy"]}};await q().set(s).from(t).save(),f.value=!1},p=v(1),_=m(()=>Math.ceil(n.trabajadores.length/T)),$=m(()=>{const t=(p.value-1)*T;return n.trabajadores.slice(t,t+T)}),S=m(()=>f.value?n.trabajadores:$.value),i=t=>{t>=1&&t<=_.value&&(p.value=t)},o=t=>{if(!t.embarcacion_id)return"Sin asignar";const s=n.embarcaciones.find(a=>a.id===t.embarcacion_id);return(s==null?void 0:s.nombre)||"Sin asignar"};return(t,s)=>(r(),l("div",H,[f.value?j("",!0):(r(),l("div",G,[e("h2",J," üìÖ Calendario de Asistencia - "+d(b.value)+" "+d(C.a√±o),1),e("button",{onClick:D,class:"bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg shadow transition-all"}," üìÑ Exportar PDF ")])),e("div",K,[e("table",Q,[e("thead",X,[e("tr",null,[s[2]||(s[2]=e("th",{class:"px-4 py-3 text-left"},"Trabajador",-1)),s[3]||(s[3]=e("th",{class:"px-4 py-3 text-left"},"Cargo",-1)),s[4]||(s[4]=e("th",{class:"px-4 py-3 text-left"},"Embarcaci√≥n",-1)),(r(!0),l(y,null,w(h.value,a=>(r(),l("th",{key:a,class:"px-2 py-3 text-center text-gray-600"},d(a),1))),128)),s[5]||(s[5]=e("th",{class:"px-4 py-3 text-center text-blue-700"},"Total TR",-1))])]),e("tbody",null,[(r(!0),l(y,null,w(S.value,a=>(r(),l("tr",{key:a.id,class:"hover:bg-blue-50 transition-colors"},[e("td",Z,d(a.nombre)+" "+d(a.apellido||""),1),e("td",ee,d(a.cargo||"Sin asignar"),1),e("td",te,d(o(a)),1),(r(!0),l(y,null,w(h.value,u=>(r(),l("td",{key:u,class:"px-1 py-1 text-center"},[e("span",{class:M(["inline-flex items-center justify-center w-6 h-6 rounded-full text-[11px] font-bold border",c(x(a,u))]),title:x(a,u)||"Sin registro"},d(x(a,u)||"-"),11,se)]))),128)),e("td",ae,d(k(a.asistencias)),1)]))),128))])]),s[6]||(s[6]=B('<div class="flex flex-wrap gap-6 mt-6 text-sm font-medium text-gray-700"><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-green-100 border border-green-400"></span> Descanso (D) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-blue-100 border border-blue-400"></span> Trabajo (TR) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-yellow-100 border border-yellow-400"></span> Licencia (L) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-red-100 border border-red-400"></span> Falta (F) </div></div>',1))]),e("div",oe,[e("button",{onClick:s[0]||(s[0]=a=>i(p.value-1)),disabled:p.value===1,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed"},s[7]||(s[7]=[e("span",{class:"mr-1"},"‚¨ÖÔ∏è",-1),F(" Anterior ")]),8,ne),(r(!0),l(y,null,w(_.value,a=>(r(),l("button",{key:a,onClick:u=>i(a),class:M(["px-3 py-1.5 rounded-md transition min-w-[2.5rem]",a===p.value?"bg-blue-600 text-white shadow-md":"border border-blue-300 text-blue-600 hover:bg-blue-100"])},d(a),11,re))),128)),e("button",{onClick:s[1]||(s[1]=a=>i(p.value+1)),disabled:p.value===_.value,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed"},s[8]||(s[8]=[F(" Siguiente "),e("span",{class:"ml-1"},"‚û°Ô∏è",-1)]),8,le)])]))}},de={class:"px-2 sm:px-4 lg:px-4 space-y-10"},ce={class:"space-y-4"},ue={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},be={class:"text-gray-700 text-lg"},pe={class:"text-blue-800 font-semibold"},me={class:"flex flex-wrap justify-center gap-4"},xe=["value"],ge=["value"],fe={key:0,class:"flex justify-center py-8"},ve={__name:"Index",setup(C){const{props:n}=R(),g=n.asistencias||[],h=n.trabajadores||[],b=v(n.mes||new Date().getMonth()+1),c=v(n.a√±o||new Date().getFullYear()),x=v(!1),k=v(2024),f=m(()=>{const i=new Date().getFullYear()+1;return Array.from({length:i-k.value+1},(o,t)=>k.value+t)}),D=m(()=>g.filter(({fecha:i})=>{const o=new Date(i);return o.getMonth()+1===b.value&&o.getFullYear()===c.value}).map(({id:i,fecha:o,estado:t,trabajador:s,embarcacion:a})=>({id:i,fecha:o,estado:t,trabajador:s.nombre,cargo:s.cargo,embarcacion:a.nombre,embarcacion_id:a.id}))),p=m(()=>[...h].sort((i,o)=>i.nombre.localeCompare(o.nombre))),_=m(()=>new Date(c.value,b.value-1).toLocaleString("default",{month:"long"}).toUpperCase());I([b,c],async([i,o])=>{x.value=!0,await A.get(route("asistencia.index"),{mes:i,a√±o:o},{preserveScroll:!0,onFinish:()=>x.value=!1})});const $=()=>A.visit(route("asistencia.create")),S=()=>A.visit(route("asistencia.manual"));return(i,o)=>(r(),U(O,null,{default:N(()=>[e("div",null,[e("div",de,[e("div",ce,[o[3]||(o[3]=e("div",{class:"flex items-center gap-3 text-blue-900"},[e("h1",{class:"text-3xl font-extrabold tracking-tight"},"Asistencia de Trabajadores")],-1)),e("div",ue,[e("p",be,[o[2]||(o[2]=F(" Calendario correspondiente a ")),e("span",pe,d(_.value)+" "+d(c.value),1)]),e("div",{class:"flex flex-wrap gap-3"},[e("button",{onClick:$,class:"inline-flex items-center gap-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," ‚ûï Crear Asistencia "),e("button",{onClick:S,class:"inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," üìù Asistencia Manual ")])])]),e("div",me,[V(e("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>b.value=t),class:"border border-blue-300 rounded-lg py-2 px-4 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"},[o[4]||(o[4]=e("option",{disabled:"",value:""},"Selecciona un mes",-1)),(r(),l(y,null,w(12,t=>e("option",{key:t,value:t},d(new Date(0,t-1).toLocaleString("default",{month:"long"})),9,xe)),64))],512),[[L,b.value]]),V(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>c.value=t),class:"border border-blue-300 rounded-lg py-2 px-4 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"},[o[5]||(o[5]=e("option",{disabled:"",value:""},"Selecciona un a√±o",-1)),(r(!0),l(y,null,w(f.value,t=>(r(),l("option",{key:t,value:t},d(t),9,ge))),128))],512),[[L,c.value]])]),x.value?(r(),l("div",fe,o[6]||(o[6]=[e("svg",{class:"animate-spin h-6 w-6 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1)]))):j("",!0),P(Y,{name:"fade",mode:"out-in"},{default:N(()=>[x.value?j("",!0):(r(),l("div",{key:b.value+"-"+c.value,class:"bg-white rounded-xl shadow-lg p-2 ring-1 ring-blue-100 transition-all overflow-x-auto"},[P(ie,{trabajadores:p.value,embarcaciones:z(n).embarcaciones||[],mes:b.value,a√±o:c.value,asistencias:D.value},null,8,["trabajadores","embarcaciones","mes","a√±o","asistencias"])]))]),_:1})])])]),_:1}))}},ke=W(ve,[["__scopeId","data-v-35bab0aa"]]);export{ke as default};
