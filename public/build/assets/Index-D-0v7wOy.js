import{k as p,r as f,c as r,b as n,f as j,e as s,t as l,l as L,F as v,h as y,n as M,p as F,q as E,s as R,x as I,W as C,y as U,w as N,d as P,g as V,v as B,T as Y,u as z}from"./app-LP7xahil.js";import{A as O}from"./AppMain-Cyb1Adui.js";import{h as q}from"./html2pdf-DXhy7gAv.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"p-4 space-y-6 overflow-auto"},G={key:0,class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},J={class:"text-2xl font-bold text-blue-800"},K={id:"calendario-pdf",class:"overflow-x-auto rounded-xl shadow ring-1 ring-blue-200 bg-white p-4"},Q={class:"min-w-full border-collapse text-sm text-gray-800"},X={class:"bg-blue-50 border-b border-blue-200 text-xs uppercase sticky top-0 z-10"},Z={class:"px-4 py-2 text-gray-600 font-semibold whitespace-nowrap"},ee={class:"px-4 py-2 text-gray-600 whitespace-nowrap"},te={class:"px-4 py-2 text-gray-600 whitespace-nowrap"},se=["title"],ae={class:"px-4 py-2 text-center font-bold text-blue-700"},oe={class:"mt-8 flex justify-center items-center space-x-1 text-sm sm:text-base font-medium"},ne=["disabled"],re=["onClick"],le=["disabled"],T=10,ie={__name:"CalendarioAsistencia",props:{trabajadores:Array,embarcaciones:Array,mes:Number,a√±o:Number},setup(D){const o=D,x=e=>e.toString().padStart(2,"0"),w=p(()=>{const e=new Date(o.a√±o,o.mes,0);return Array.from({length:e.getDate()},(t,a)=>a+1)}),u=p(()=>new Date(o.a√±o,o.mes-1).toLocaleString("default",{month:"long"}).toUpperCase()),c=e=>({D:"bg-green-100 text-green-800 border-green-300",TR:"bg-blue-100 text-blue-800 border-blue-300",L:"bg-yellow-100 text-yellow-800 border-yellow-300",F:"bg-red-100 text-red-800 border-red-300"})[e]||"bg-gray-100 text-gray-400 border-gray-300",m=(e,t)=>{var i;const a=`${o.a√±o}-${x(o.mes)}-${x(t)}`;return((i=e.asistencias)==null?void 0:i[a])||null},k=e=>w.value.reduce((t,a)=>{const i=`${o.a√±o}-${x(o.mes)}-${x(a)}`;return(e==null?void 0:e[i])==="TR"?t+1:t},0),g=f(!1),$=async()=>{g.value=!0,await E();const e=document.getElementById("calendario-pdf"),t={margin:-.1,filename:`calendario-${new Date().toISOString().slice(0,10)}.pdf`,image:{type:"jpeg",quality:.8},html2canvas:{scale:2,useCORS:!0,backgroundColor:"#fff"},jsPDF:{unit:"in",format:[8.5,16],orientation:"landscape"},pagebreak:{mode:["avoid-all","css","legacy"]}};await q().set(t).from(e).save(),g.value=!1},b=f(1),h=p(()=>Math.ceil(o.trabajadores.length/T)),A=p(()=>{const e=(b.value-1)*T;return o.trabajadores.slice(e,e+T)}),S=p(()=>g.value?o.trabajadores:A.value),_=e=>{e>=1&&e<=h.value&&(b.value=e)},d=e=>{if(!e.embarcacion_id)return"Sin asignar";const t=o.embarcaciones.find(a=>a.id===e.embarcacion_id);return(t==null?void 0:t.nombre)||"Sin asignar"};return(e,t)=>(n(),r("div",H,[g.value?j("",!0):(n(),r("div",G,[s("h2",J," üìÖ Calendario de Asistencia - "+l(u.value)+" "+l(D.a√±o),1),s("button",{onClick:$,class:"bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg shadow transition-all"}," üìÑ Exportar PDF ")])),s("div",K,[s("table",Q,[s("thead",X,[s("tr",null,[t[2]||(t[2]=s("th",{class:"px-4 py-3 text-left"},"Trabajador",-1)),t[3]||(t[3]=s("th",{class:"px-4 py-3 text-left"},"Cargo",-1)),t[4]||(t[4]=s("th",{class:"px-4 py-3 text-left"},"Embarcaci√≥n",-1)),(n(!0),r(v,null,y(w.value,a=>(n(),r("th",{key:a,class:"px-2 py-3 text-center text-gray-600"},l(a),1))),128)),t[5]||(t[5]=s("th",{class:"px-4 py-3 text-center text-blue-700"},"Total TR",-1))])]),s("tbody",null,[(n(!0),r(v,null,y(S.value,a=>(n(),r("tr",{key:a.id,class:"hover:bg-blue-50 transition-colors"},[s("td",Z,l(a.nombre)+" "+l(a.apellido||""),1),s("td",ee,l(a.cargo||"Sin asignar"),1),s("td",te,l(d(a)),1),(n(!0),r(v,null,y(w.value,i=>(n(),r("td",{key:i,class:"px-1 py-1 text-center"},[s("span",{class:M(["inline-flex items-center justify-center w-6 h-6 rounded-full text-[11px] font-bold border",c(m(a,i))]),title:m(a,i)||"Sin registro"},l(m(a,i)||"-"),11,se)]))),128)),s("td",ae,l(k(a.asistencias)),1)]))),128))])]),t[6]||(t[6]=L('<div class="flex flex-wrap gap-6 mt-6 text-sm font-medium text-gray-700"><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-green-100 border border-green-400"></span> Descanso (D) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-blue-100 border border-blue-400"></span> Trabajo (TR) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-yellow-100 border border-yellow-400"></span> Licencia (L) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-red-100 border border-red-400"></span> Falta (F) </div></div>',1))]),s("div",oe,[s("button",{onClick:t[0]||(t[0]=a=>_(b.value-1)),disabled:b.value===1,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed"},t[7]||(t[7]=[s("span",{class:"mr-1"},"‚¨ÖÔ∏è",-1),F(" Anterior ")]),8,ne),(n(!0),r(v,null,y(h.value,a=>(n(),r("button",{key:a,onClick:i=>_(a),class:M(["px-3 py-1.5 rounded-md transition min-w-[2.5rem]",a===b.value?"bg-blue-600 text-white shadow-md":"border border-blue-300 text-blue-600 hover:bg-blue-100"])},l(a),11,re))),128)),s("button",{onClick:t[1]||(t[1]=a=>_(b.value+1)),disabled:b.value===h.value,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed"},t[8]||(t[8]=[F(" Siguiente "),s("span",{class:"ml-1"},"‚û°Ô∏è",-1)]),8,le)])]))}},de={class:"px-2 sm:px-4 lg:px-4 space-y-10"},ce={class:"space-y-4"},ue={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},be={class:"text-gray-700 text-lg"},pe={class:"text-blue-800 font-semibold"},me={class:"flex flex-wrap justify-center gap-4"},xe=["value"],ge=["value"],fe={key:0,class:"flex justify-center py-8"},ve={__name:"Index",setup(D){const{props:o}=R(),x=o.asistencias||[],w=o.trabajadores||[],u=f(o.mes||new Date().getMonth()+1),c=f(o.a√±o||new Date().getFullYear()),m=f(!1),k=f(2024),g=p(()=>{const d=new Date().getFullYear()+1;return Array.from({length:d-k.value+1},(e,t)=>k.value+t)}),$=p(()=>x.filter(({fecha:d})=>{const e=new Date(d);return e.getMonth()+1===u.value&&e.getFullYear()===c.value}).map(({id:d,fecha:e,estado:t,trabajador:a,embarcacion:i})=>({id:d,fecha:e,estado:t,trabajador:a.nombre,cargo:a.cargo,embarcacion:i.nombre,embarcacion_id:i.id}))),b=p(()=>[...w].sort((d,e)=>d.nombre.localeCompare(e.nombre))),h=p(()=>new Date(c.value,u.value-1).toLocaleString("default",{month:"long"}).toUpperCase());I([u,c],async([d,e])=>{m.value=!0,await C.get(route("asistencia.index"),{mes:d,a√±o:e},{preserveScroll:!0,onFinish:()=>m.value=!1})});const A=()=>C.visit(route("asistencia.create")),S=()=>C.visit(route("asistencia.manual")),_=()=>C.visit(route("asistencia.bajada"));return(d,e)=>(n(),U(O,null,{default:N(()=>[s("div",null,[s("div",de,[s("div",ce,[e[3]||(e[3]=s("div",{class:"flex items-center gap-3 text-blue-900"},[s("h1",{class:"text-3xl font-extrabold tracking-tight"},"Asistencia de Trabajadores")],-1)),s("div",ue,[s("p",be,[e[2]||(e[2]=F(" Calendario correspondiente a ")),s("span",pe,l(h.value)+" "+l(c.value),1)]),s("div",{class:"flex flex-wrap gap-3"},[s("button",{onClick:A,class:"inline-flex items-center gap-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," ‚ûï Crear Asistencia "),s("button",{onClick:S,class:"inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," üìù Asistencia Manual "),s("button",{onClick:_,class:"inline-flex items-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," üì• Crear Descanso ")])])]),s("div",me,[V(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),class:"border border-blue-300 rounded-lg py-2 px-4 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"},[e[4]||(e[4]=s("option",{disabled:"",value:""},"Selecciona un mes",-1)),(n(),r(v,null,y(12,t=>s("option",{key:t,value:t},l(new Date(0,t-1).toLocaleString("default",{month:"long"})),9,xe)),64))],512),[[B,u.value]]),V(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),class:"border border-blue-300 rounded-lg py-2 px-4 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"},[e[5]||(e[5]=s("option",{disabled:"",value:""},"Selecciona un a√±o",-1)),(n(!0),r(v,null,y(g.value,t=>(n(),r("option",{key:t,value:t},l(t),9,ge))),128))],512),[[B,c.value]])]),m.value?(n(),r("div",fe,e[6]||(e[6]=[s("svg",{class:"animate-spin h-6 w-6 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1)]))):j("",!0),P(Y,{name:"fade",mode:"out-in"},{default:N(()=>[m.value?j("",!0):(n(),r("div",{key:u.value+"-"+c.value,class:"bg-white rounded-xl shadow-lg p-2 ring-1 ring-blue-100 transition-all overflow-x-auto"},[P(ie,{trabajadores:b.value,embarcaciones:z(o).embarcaciones||[],mes:u.value,a√±o:c.value,asistencias:$.value},null,8,["trabajadores","embarcaciones","mes","a√±o","asistencias"])]))]),_:1})])])]),_:1}))}},ke=W(ve,[["__scopeId","data-v-21eb510f"]]);export{ke as default};
