import{s as R,r as p,k as b,x as J,G as K,c as n,b as i,d as k,u as Q,m as X,w as Y,e,i as Z,g as _,f as T,v as ee,j as P,t as a,F as g,h as $,n as N,p as B,W as S}from"./app-DG0kc4f6.js";import{A as te}from"./AppMain-DjWXVROa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"container mx-auto px-4 py-6 flex flex-col flex-1"},oe={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0 gap-4"},ae={class:"flex flex-col w-full sm:w-48"},le={key:0,id:"error-factura",class:"text-red-600 text-xs mt-1 font-semibold"},re={class:"flex flex-wrap gap-2 items-center w-full sm:w-auto"},ne=["max"],ie=["min"],de={key:0,id:"error-fechas",class:"text-red-600 text-xs mt-1 w-full sm:w-auto font-semibold"},ue={class:"mb-6"},ce={class:"hidden sm:block overflow-x-auto rounded-lg border border-gray-200 shadow-sm bg-white"},fe={class:"w-full min-w-[1100px] text-sm text-gray-800"},pe={class:"px-4 py-3"},be={class:"px-4 py-3"},me={class:"px-4 py-3"},xe={class:"px-4 py-3"},ve={class:"px-4 py-3"},he={class:"px-4 py-3"},ye={class:"px-4 py-3"},_e={class:"px-4 py-3"},ge={class:"px-4 py-3"},we={class:"px-4 py-3"},Ce={class:"px-4 py-3"},Fe={class:"px-4 py-3 text-center space-x-2 whitespace-nowrap"},Ee=["onClick"],ke=["onClick"],Pe={class:"sm:hidden w-full space-y-4 mt-6"},$e={class:"text-blue-800 font-semibold text-lg mb-2 truncate"},Ne={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-700"},Se={class:"mt-4 flex flex-wrap gap-2 justify-end"},Ve=["onClick"],Ae=["onClick"],Ge={class:"mt-8 flex justify-center items-center space-x-1 text-sm sm:text-base font-medium",role:"navigation","aria-label":"Paginación de gastos"},Le=["disabled"],De=["onClick","aria-label"],ze=["disabled"],V=10,He={__name:"Index",setup(je){var M;const w=R().props,m=p("pendiente"),d=p(""),u=p(""),c=p(""),r=p({facturaFiltro:"",fechas:"",estadoFiltro:""}),f=p(1),C=p(Array.isArray(w.gastos)?w.gastos:((M=w.gastos)==null?void 0:M.data)??[]),H=b(()=>C.value.map(s=>({id:s.id,cotizacion:s.cotizacion,centro_barco:s.centro_barco,orden_compra:s.orden_compra,fecha_oc:s.fecha_oc,hes:s.hes,fecha_hes:s.fecha_hes,valor_neto:s.valor_neto,empresa_facturar:s.empresa_facturar,factura:s.factura,estado:s.estado,valor_facturado:s.valor_facturado})));J([d,u,c,m],()=>{O(),f.value=1});const O=()=>{r.value={facturaFiltro:"",fechas:"",estadoFiltro:""},d.value.length>20?r.value.facturaFiltro="Máximo 20 caracteres.":d.value&&!/^[\w\-]*$/.test(d.value)&&(r.value.facturaFiltro="Solo letras, números y guiones."),u.value&&c.value&&u.value>c.value&&(r.value.fechas="Fecha inicio no puede ser mayor que fecha fin."),["pendiente","pagada","todas"].includes(m.value)||(r.value.estadoFiltro="Estado inválido.")},F=b(()=>Object.values(r.value).some(s=>s)?[]:H.value.filter(s=>{var t,l;return!(m.value!=="todas"&&((t=s.estado)==null?void 0:t.toLowerCase())!==m.value||d.value&&!((l=s.factura)!=null&&l.toLowerCase().includes(d.value.toLowerCase()))||u.value&&(!s.fecha_oc||s.fecha_oc<u.value)||c.value&&(!s.fecha_oc||s.fecha_oc>c.value))})),A=b(()=>{const s={pendiente:0,pagada:0};return F.value.forEach(t=>{var o;const l=(o=t.estado)==null?void 0:o.toLowerCase();s[l]!==void 0&&(s[l]+=Number(t.valor_neto||0))}),s}),I=b(()=>["Pendiente","Pagada"]),U=b(()=>[A.value.pendiente,A.value.pagada]),x=b(()=>Math.ceil(F.value.length/V)),G=b(()=>{const s=(f.value-1)*V;return F.value.slice(s,s+V)}),W=s=>{s>=1&&s<=x.value&&(f.value=s)},v=s=>{if(!s)return"";const[t,l,o]=s.split("T")[0].split("-");return`${o}/${l}/${t}`},h=s=>s?Number(s).toLocaleString("es-CL",{minimumFractionDigits:0}):"0",q=()=>{S.visit(route("gastos.create"))},L=s=>{S.visit(route("gastos.edit",s))},D=s=>{confirm("¿Estás seguro de eliminar este gasto?")&&S.delete(route("gastos.destroy",s),{preserveScroll:!0,onSuccess:()=>{const t=[...C.value].filter(l=>l.id!==s);C.value=t},onError:()=>{alert("Error al eliminar el gasto.")}})},z=s=>{switch(s==null?void 0:s.toLowerCase()){case"pagada":return"bg-green-100 text-green-800 border border-green-300";case"pendiente":return"bg-yellow-100 text-yellow-800 border border-yellow-300";default:return"bg-gray-100 text-gray-800 border border-gray-300"}},j=s=>{switch(s==null?void 0:s.toLowerCase()){case"pagada":return"✅";case"pendiente":return"⏳";default:return"ℹ️"}},E=s=>{W(s)};return(s,t)=>{const l=K("GastoChart");return i(),n(g,null,[k(Q(X),{title:"Gastos"}),k(te,null,{default:Y(()=>[e("main",se,[e("header",oe,[t[10]||(t[10]=e("h2",{class:"text-3xl font-bold text-blue-900 flex items-center gap-2 select-none"}," Registro de Gastos ",-1)),e("form",{onSubmit:t[4]||(t[4]=Z(()=>{},["prevent"])),class:"flex flex-wrap gap-4 items-center justify-end w-full sm:w-auto","aria-label":"Filtros de gastos"},[_(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>m.value=o),"aria-label":"Filtro por estado",class:"appearance-none w-full sm:w-40 border border-blue-300 rounded-md bg-white px-4 py-2 pr-10 text-sm shadow-md text-blue-800 font-medium focus:outline-none focus:ring-2 focus:ring-blue-200 transition"},t[7]||(t[7]=[e("option",{value:"pendiente"},"⏳ Pendientes",-1),e("option",{value:"pagada"},"✅ Pagadas",-1),e("option",{value:"todas"},"📋 Todas",-1)]),512),[[ee,m.value]]),e("div",ae,[_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>d.value=o),type:"text",placeholder:"Buscar por Nº Factura...","aria-describedby":"error-factura",class:"border border-blue-300 rounded-md px-3 py-2 text-sm text-blue-800 font-medium focus:outline-none focus:ring-2 focus:ring-blue-200 shadow-md"},null,512),[[P,d.value]]),r.value.facturaFiltro?(i(),n("p",le,a(r.value.facturaFiltro),1)):T("",!0)]),e("div",re,[t[8]||(t[8]=e("label",{for:"fecha-inicio",class:"text-sm text-blue-800 font-semibold select-none"},"Desde:",-1)),_(e("input",{id:"fecha-inicio","onUpdate:modelValue":t[2]||(t[2]=o=>u.value=o),type:"date",max:c.value||void 0,"aria-describedby":"error-fechas",class:"border border-blue-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200"},null,8,ne),[[P,u.value]]),t[9]||(t[9]=e("label",{for:"fecha-fin",class:"text-sm text-blue-800 font-semibold select-none"},"Hasta:",-1)),_(e("input",{id:"fecha-fin","onUpdate:modelValue":t[3]||(t[3]=o=>c.value=o),type:"date",min:u.value||void 0,"aria-describedby":"error-fechas",class:"border border-blue-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200"},null,8,ie),[[P,c.value]])]),r.value.fechas?(i(),n("p",de,a(r.value.fechas),1)):T("",!0),e("button",{type:"button",onClick:q,class:"bg-blue-800 text-white rounded-lg px-5 py-2 text-sm font-semibold hover:bg-blue-900 shadow-md transition whitespace-nowrap","aria-label":"Crear nuevo gasto"}," ➕ Nuevo Gasto ")],32)]),e("section",ue,[k(l,{labels:I.value,data:U.value,title:"Distribución de Gastos por Estado",class:"max-w-md mx-auto sm:max-w-full"},null,8,["labels","data"])]),e("section",ce,[e("table",fe,[t[11]||(t[11]=e("thead",{class:"bg-blue-100 text-blue-900 select-none"},[e("tr",null,[e("th",{class:"px-4 py-3 font-semibold text-left"},"Cotización"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Centro-Barco"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Orden Compra"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Fecha OC"),e("th",{class:"px-4 py-3 font-semibold text-left"},"HES"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Fecha HES"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Valor Neto"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Empresa"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Nº Factura"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Valor Facturado"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Estado"),e("th",{class:"px-4 py-3 font-semibold text-center"},"Acciones")])],-1)),e("tbody",null,[(i(!0),n(g,null,$(G.value,o=>(i(),n("tr",{key:o.id,class:"border-t border-gray-200 hover:bg-blue-50 transition"},[e("td",pe,a(o.cotizacion),1),e("td",be,a(o.centro_barco),1),e("td",me,a(o.orden_compra),1),e("td",xe,a(v(o.fecha_oc)),1),e("td",ve,a(o.hes),1),e("td",he,a(v(o.fecha_hes)),1),e("td",ye,"$"+a(h(o.valor_neto)),1),e("td",_e,a(o.empresa_facturar),1),e("td",ge,a(o.factura),1),e("td",we,"$"+a(h(o.valor_facturado)),1),e("td",Ce,[e("span",{class:N([z(o.estado),"px-3 py-1 rounded-full text-xs font-semibold inline-flex items-center gap-1 shadow-sm transition"])},a(j(o.estado))+" "+a(o.estado),3)]),e("td",Fe,[e("button",{onClick:y=>L(o.id),class:"text-blue-600 hover:text-blue-900 font-semibold px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400",title:"Editar gasto","aria-label":"Editar gasto"}," ✏️ ",8,Ee),e("button",{onClick:y=>D(o.id),class:"text-red-600 hover:text-red-900 font-semibold px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400",title:"Eliminar gasto","aria-label":"Eliminar gasto"}," 🗑️ ",8,ke)])]))),128))])])]),e("section",Pe,[(i(!0),n(g,null,$(G.value,o=>(i(),n("article",{key:o.id,class:"bg-white shadow-md rounded-lg p-4 border border-gray-200",role:"listitem",tabindex:"0","aria-label":"Gasto detalle"},[e("h3",$e,a(o.centro_barco),1),e("dl",Ne,[t[12]||(t[12]=e("dt",{class:"font-semibold"},"Cotización:",-1)),e("dd",null,a(o.cotizacion),1),t[13]||(t[13]=e("dt",{class:"font-semibold"},"Orden Compra:",-1)),e("dd",null,a(o.orden_compra),1),t[14]||(t[14]=e("dt",{class:"font-semibold"},"Fecha OC:",-1)),e("dd",null,a(v(o.fecha_oc)),1),t[15]||(t[15]=e("dt",{class:"font-semibold"},"HES:",-1)),e("dd",null,a(o.hes),1),t[16]||(t[16]=e("dt",{class:"font-semibold"},"Fecha HES:",-1)),e("dd",null,a(v(o.fecha_hes)),1),t[17]||(t[17]=e("dt",{class:"font-semibold"},"Valor Neto:",-1)),e("dd",null,"$"+a(h(o.valor_neto)),1),t[18]||(t[18]=e("dt",{class:"font-semibold"},"Valor Facturado:",-1)),e("dd",null,"$"+a(h(o.valor_facturado)),1),t[19]||(t[19]=e("dt",{class:"font-semibold"},"Empresa:",-1)),e("dd",null,a(o.empresa_facturar),1),t[20]||(t[20]=e("dt",{class:"font-semibold"},"Nº Factura:",-1)),e("dd",null,a(o.factura),1),t[21]||(t[21]=e("dt",{class:"font-semibold"},"Estado:",-1)),e("dd",null,[e("span",{class:N([z(o.estado),"px-2 py-1 rounded-full text-xs font-semibold inline-flex items-center gap-1 shadow-sm transition"])},a(j(o.estado))+" "+a(o.estado),3)])]),e("div",Se,[e("button",{onClick:y=>L(o.id),class:"text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Editar gasto"}," ✏️ Editar ",8,Ve),e("button",{onClick:y=>D(o.id),class:"text-white px-3 py-1 rounded-md text-sm hover:bg-red-600 transition focus:outline-none focus:ring-2 focus:ring-red-400","aria-label":"Eliminar gasto"}," 🗑️ Eliminar ",8,Ae)])]))),128))]),e("nav",Ge,[e("button",{onClick:t[5]||(t[5]=o=>E(f.value-1)),disabled:f.value===1,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed","aria-disabled":"paginaActual === 1","aria-label":"Página anterior"},t[22]||(t[22]=[e("span",{class:"mr-1"},"⬅️",-1),B(" Anterior ")]),8,Le),(i(!0),n(g,null,$(x.value,o=>(i(),n("button",{key:o,onClick:y=>E(o),class:N(["px-3 py-1.5 rounded-md transition min-w-[2.5rem] truncate",o===f.value?"bg-blue-600 text-white":"border border-blue-500 text-blue-600 hover:bg-blue-100"]),"aria-current":"page === paginaActual ? 'page' : false","aria-label":`Ir a la página ${o}`},a(o),11,De))),128)),e("button",{onClick:t[6]||(t[6]=o=>E(f.value+1)),disabled:f.value===x.value||x.value===0,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed","aria-disabled":"paginaActual === totalPaginas || totalPaginas === 0","aria-label":"Página siguiente"},t[23]||(t[23]=[B(" Siguiente "),e("span",{class:"ml-1"},"➡️",-1)]),8,ze)])])]),_:1})],64)}}};export{He as default};
