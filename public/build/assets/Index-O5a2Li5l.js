import{r as x,k as p,c as l,b as n,f as F,e,t as d,g as L,j as E,l as R,F as h,h as _,n as N,p as M,q as I,s as U,x as Y,W as k,y as q,w as P,d as B,v as V,T as z,u as O}from"./app-BxYVhS8M.js";import{A as W}from"./AppMain-D0lmhenI.js";import{h as H}from"./html2pdf-U5oix5On.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"p-4 space-y-6 overflow-auto"},J={key:0,class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},K={class:"text-2xl font-bold text-blue-800"},X={class:"flex justify-between items-center mb-4 w-80"},Z={id:"calendario-pdf",class:"overflow-x-auto rounded-xl shadow ring-1 ring-blue-200 bg-white p-4"},ee={class:"min-w-full border-collapse text-sm text-gray-800"},te={class:"bg-blue-50 border-b border-blue-200 text-xs uppercase sticky top-0 z-10"},se={class:"px-4 py-2 text-gray-600 font-semibold whitespace-nowrap"},ae={class:"px-4 py-2 text-gray-600 whitespace-nowrap"},oe={class:"px-4 py-2 text-gray-600 whitespace-nowrap"},re=["title"],ne={class:"px-4 py-2 text-center font-bold text-blue-700"},le={class:"mt-8 flex justify-center items-center space-x-1 text-sm sm:text-base font-medium"},ie=["disabled"],de=["onClick"],ce=["disabled"],T=10,ue={__name:"CalendarioAsistencia",props:{trabajadores:Array,embarcaciones:Array,mes:Number,a√±o:Number},setup(D){const r=D,g=x(""),f=t=>t.toString().padStart(2,"0"),u=p(()=>{const t=new Date(r.a√±o,r.mes,0);return Array.from({length:t.getDate()},(s,a)=>a+1)}),b=p(()=>new Date(r.a√±o,r.mes-1).toLocaleString("default",{month:"long"}).toUpperCase()),v=t=>({D:"bg-green-100 text-green-800 border-green-300",TR:"bg-blue-100 text-blue-800 border-blue-300",L:"bg-yellow-100 text-yellow-800 border-yellow-300",F:"bg-red-100 text-red-800 border-red-300"})[t]||"bg-gray-100 text-gray-400 border-gray-300",y=(t,s)=>{var c;const a=`${r.a√±o}-${f(r.mes)}-${f(s)}`;return((c=t.asistencias)==null?void 0:c[a])||null},$=t=>u.value.reduce((s,a)=>{const c=`${r.a√±o}-${f(r.mes)}-${f(a)}`;return(t==null?void 0:t[c])==="TR"?s+1:s},0),w=x(!1),A=async()=>{w.value=!0,await I();const t=document.getElementById("calendario-pdf"),s={margin:-.1,filename:`calendario-${new Date().toISOString().slice(0,10)}.pdf`,image:{type:"jpeg",quality:.8},html2canvas:{scale:2,useCORS:!0,backgroundColor:"#fff"},jsPDF:{unit:"in",format:[8.5,16],orientation:"landscape"},pagebreak:{mode:["avoid-all","css","legacy"]}};await H().set(s).from(t).save(),w.value=!1},m=x(1),C=p(()=>Math.ceil(r.trabajadores.length/T)),S=p(()=>{const t=(m.value-1)*T;return r.trabajadores.slice(t,t+T)});p(()=>w.value?r.trabajadores:S.value);const j=p(()=>{if(!g.value)return r.trabajadores;const t=g.value.toLowerCase();return r.trabajadores.filter(s=>{const a=`${s.nombre} ${s.apellido||""}`.toLowerCase(),c=o(s).toLowerCase();return a.includes(t)||c.includes(t)})}),i=t=>{t>=1&&t<=C.value&&(m.value=t)},o=t=>{if(!t.embarcacion_id)return"Sin asignar";const s=r.embarcaciones.find(a=>a.id===t.embarcacion_id);return(s==null?void 0:s.nombre)||"Sin asignar"};return(t,s)=>(n(),l("div",G,[w.value?F("",!0):(n(),l("div",J,[e("h2",K," üìÖ Calendario de Asistencia - "+d(b.value)+" "+d(D.a√±o),1),e("button",{onClick:A,class:"bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg shadow transition-all"}," üìÑ Exportar PDF ")])),e("div",X,[L(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>g.value=a),type:"text",placeholder:"Buscar por nombre o embarcaci√≥n...",class:"w-full px-4 py-2 border border-gray-300 rounded-md text-lg focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[E,g.value]])]),e("div",Z,[e("table",ee,[e("thead",te,[e("tr",null,[s[3]||(s[3]=e("th",{class:"px-4 py-3 text-left"},"Trabajador",-1)),s[4]||(s[4]=e("th",{class:"px-4 py-3 text-left"},"Cargo",-1)),s[5]||(s[5]=e("th",{class:"px-4 py-3 text-left"},"Embarcaci√≥n",-1)),(n(!0),l(h,null,_(u.value,a=>(n(),l("th",{key:a,class:"px-2 py-3 text-center text-gray-600"},d(a),1))),128)),s[6]||(s[6]=e("th",{class:"px-4 py-3 text-center text-blue-700"},"Total TR",-1))])]),e("tbody",null,[(n(!0),l(h,null,_(j.value,a=>(n(),l("tr",{key:a.id,class:"hover:bg-blue-50 transition-colors"},[e("td",se,d(a.nombre)+" "+d(a.apellido||""),1),e("td",ae,d(a.cargo||"Sin asignar"),1),e("td",oe,d(o(a)),1),(n(!0),l(h,null,_(u.value,c=>(n(),l("td",{key:c,class:"px-1 py-1 text-center"},[e("span",{class:N(["inline-flex items-center justify-center w-6 h-6 rounded-full text-[11px] font-bold border",v(y(a,c))]),title:y(a,c)||"Sin registro"},d(y(a,c)||"-"),11,re)]))),128)),e("td",ne,d($(a.asistencias)),1)]))),128))])]),s[7]||(s[7]=R('<div class="flex flex-wrap gap-6 mt-6 text-sm font-medium text-gray-700"><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-green-100 border border-green-400"></span> Descanso (D) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-blue-100 border border-blue-400"></span> Trabajo (TR) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-yellow-100 border border-yellow-400"></span> Licencia (L) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-red-100 border border-red-400"></span> Falta (F) </div></div>',1))]),e("div",le,[e("button",{onClick:s[1]||(s[1]=a=>i(m.value-1)),disabled:m.value===1,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed"},s[8]||(s[8]=[e("span",{class:"mr-1"},"‚¨ÖÔ∏è",-1),M(" Anterior ")]),8,ie),(n(!0),l(h,null,_(C.value,a=>(n(),l("button",{key:a,onClick:c=>i(a),class:N(["px-3 py-1.5 rounded-md transition min-w-[2.5rem]",a===m.value?"bg-blue-600 text-white shadow-md":"border border-blue-300 text-blue-600 hover:bg-blue-100"])},d(a),11,de))),128)),e("button",{onClick:s[2]||(s[2]=a=>i(m.value+1)),disabled:m.value===C.value,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed"},s[9]||(s[9]=[M(" Siguiente "),e("span",{class:"ml-1"},"‚û°Ô∏è",-1)]),8,ce)])]))}},be={class:"px-2 sm:px-4 lg:px-4 space-y-10"},pe={class:"space-y-4"},me={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},xe={class:"text-gray-700 text-lg"},ge={class:"text-blue-800 font-semibold"},fe={class:"flex flex-wrap justify-center gap-4"},ve=["value"],ye=["value"],we={key:0,class:"flex justify-center py-8"},he={__name:"Index",setup(D){const{props:r}=U(),g=r.asistencias||[],f=r.trabajadores||[],u=x(r.mes||new Date().getMonth()+1),b=x(r.a√±o||new Date().getFullYear()),v=x(!1),y=x(2024),$=p(()=>{const i=new Date().getFullYear()+1;return Array.from({length:i-y.value+1},(o,t)=>y.value+t)}),w=p(()=>g.filter(({fecha:i})=>{const o=new Date(i);return o.getMonth()+1===u.value&&o.getFullYear()===b.value}).map(({id:i,fecha:o,estado:t,trabajador:s,embarcacion:a})=>({id:i,fecha:o,estado:t,trabajador:s.nombre,cargo:s.cargo,embarcacion:a.nombre,embarcacion_id:a.id}))),A=p(()=>[...f].sort((i,o)=>i.nombre.localeCompare(o.nombre))),m=p(()=>new Date(b.value,u.value-1).toLocaleString("default",{month:"long"}).toUpperCase());Y([u,b],async([i,o])=>{v.value=!0,await k.get(route("asistencia.index"),{mes:i,a√±o:o},{preserveScroll:!0,onFinish:()=>v.value=!1})});const C=()=>k.visit(route("asistencia.create")),S=()=>k.visit(route("asistencia.manual")),j=()=>k.visit(route("asistencia.bajada"));return(i,o)=>(n(),q(W,null,{default:P(()=>[e("div",null,[e("div",be,[e("div",pe,[o[3]||(o[3]=e("div",{class:"flex items-center gap-3 text-blue-900"},[e("h1",{class:"text-3xl font-extrabold tracking-tight"},"Asistencia de Trabajadores")],-1)),e("div",me,[e("p",xe,[o[2]||(o[2]=M(" Calendario correspondiente a ")),e("span",ge,d(m.value)+" "+d(b.value),1)]),e("div",{class:"flex flex-wrap gap-3"},[e("button",{onClick:C,class:"inline-flex items-center gap-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," ‚ûï Crear Asistencia "),e("button",{onClick:S,class:"inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," üìù Asistencia Manual "),e("button",{onClick:j,class:"inline-flex items-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," üì• Crear Bajada ")])])]),e("div",fe,[L(e("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>u.value=t),class:"border border-blue-300 rounded-lg py-2 px-4 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"},[o[4]||(o[4]=e("option",{disabled:"",value:""},"Selecciona un mes",-1)),(n(),l(h,null,_(12,t=>e("option",{key:t,value:t},d(new Date(0,t-1).toLocaleString("default",{month:"long"})),9,ve)),64))],512),[[V,u.value]]),L(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>b.value=t),class:"border border-blue-300 rounded-lg py-2 px-4 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"},[o[5]||(o[5]=e("option",{disabled:"",value:""},"Selecciona un a√±o",-1)),(n(!0),l(h,null,_($.value,t=>(n(),l("option",{key:t,value:t},d(t),9,ye))),128))],512),[[V,b.value]])]),v.value?(n(),l("div",we,o[6]||(o[6]=[e("svg",{class:"animate-spin h-6 w-6 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1)]))):F("",!0),B(z,{name:"fade",mode:"out-in"},{default:P(()=>[v.value?F("",!0):(n(),l("div",{key:u.value+"-"+b.value,class:"bg-white rounded-xl shadow-lg p-2 ring-1 ring-blue-100 transition-all overflow-x-auto"},[B(ue,{trabajadores:A.value,embarcaciones:O(r).embarcaciones||[],mes:u.value,a√±o:b.value,asistencias:w.value},null,8,["trabajadores","embarcaciones","mes","a√±o","asistencias"])]))]),_:1})])])]),_:1}))}},$e=Q(he,[["__scopeId","data-v-4d343fa9"]]);export{$e as default};
