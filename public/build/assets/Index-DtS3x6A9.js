import{s as q,r as m,k as p,x as R,G as J,c as n,b as i,d as k,u as K,m as Q,w as X,e,i as Y,g as _,f as j,v as Z,j as E,t as a,F as g,h as P,n as $,p as M,W as N}from"./app-LP7xahil.js";import{A as ee}from"./AppMain-Cyb1Adui.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"container mx-auto px-4 py-6 flex flex-col flex-1"},se={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0 gap-4"},oe={class:"flex flex-col w-full sm:w-48"},ae={key:0,id:"error-factura",class:"text-red-600 text-xs mt-1 font-semibold"},le={class:"flex flex-wrap gap-2 items-center w-full sm:w-auto"},re=["max"],ne=["min"],ie={key:0,id:"error-fechas",class:"text-red-600 text-xs mt-1 w-full sm:w-auto font-semibold"},de={class:"mb-6"},ue={class:"hidden sm:block overflow-x-auto rounded-lg border border-gray-200 shadow-sm bg-white"},ce={class:"w-full min-w-[1100px] text-sm text-gray-800"},fe={class:"px-4 py-3"},pe={class:"px-4 py-3"},be={class:"px-4 py-3"},me={class:"px-4 py-3"},xe={class:"px-4 py-3"},ve={class:"px-4 py-3"},he={class:"px-4 py-3"},ye={class:"px-4 py-3"},_e={class:"px-4 py-3"},ge={class:"px-4 py-3"},we={class:"px-4 py-3"},Ce={class:"px-4 py-3 text-center space-x-2 whitespace-nowrap"},Fe=["onClick"],ke=["onClick"],Ee={class:"sm:hidden w-full space-y-4 mt-6"},Pe={class:"text-blue-800 font-semibold text-lg mb-2 truncate"},$e={class:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-700"},Ne={class:"mt-4 flex flex-wrap gap-2 justify-end"},Ve=["onClick"],Ae=["onClick"],Ge={class:"mt-8 flex justify-center items-center space-x-1 text-sm sm:text-base font-medium",role:"navigation","aria-label":"Paginación de gastos"},Le=["disabled"],Se=["onClick","aria-label"],De=["disabled"],V=10,Be={__name:"Index",setup(ze){const w=q().props,b=m("pendiente"),d=m(""),u=m(""),c=m(""),l=m({facturaFiltro:"",fechas:"",estadoFiltro:""}),f=m(1),T=p(()=>{var t;return Array.isArray(w.gastos)?w.gastos:((t=w.gastos)==null?void 0:t.data)??[]}),B=p(()=>T.value.map(t=>({id:t.id,cotizacion:t.cotizacion,centro_barco:t.centro_barco,orden_compra:t.orden_compra,fecha_oc:t.fecha_oc,hes:t.hes,fecha_hes:t.fecha_hes,valor_neto:t.valor_neto,empresa_facturar:t.empresa_facturar,factura:t.factura,estado:t.estado,valor_facturado:t.valor_facturado})));R([d,u,c,b],()=>{H(),f.value=1});const H=()=>{l.value={facturaFiltro:"",fechas:"",estadoFiltro:""},d.value.length>20?l.value.facturaFiltro="Máximo 20 caracteres.":d.value&&!/^[\w\-]*$/.test(d.value)&&(l.value.facturaFiltro="Solo letras, números y guiones."),u.value&&c.value&&u.value>c.value&&(l.value.fechas="Fecha inicio no puede ser mayor que fecha fin."),["pendiente","pagada","todas"].includes(b.value)||(l.value.estadoFiltro="Estado inválido.")},C=p(()=>Object.values(l.value).some(t=>t)?[]:B.value.filter(t=>{var s,r;return!(b.value!=="todas"&&((s=t.estado)==null?void 0:s.toLowerCase())!==b.value||d.value&&!((r=t.factura)!=null&&r.toLowerCase().includes(d.value.toLowerCase()))||u.value&&(!t.fecha_oc||t.fecha_oc<u.value)||c.value&&(!t.fecha_oc||t.fecha_oc>c.value))})),A=p(()=>{const t={pendiente:0,pagada:0};return C.value.forEach(s=>{var o;const r=(o=s.estado)==null?void 0:o.toLowerCase();t[r]!==void 0&&(t[r]+=Number(s.valor_neto||0))}),t}),O=p(()=>["Pendiente","Pagada"]),I=p(()=>[A.value.pendiente,A.value.pagada]),x=p(()=>Math.ceil(C.value.length/V)),G=p(()=>{const t=(f.value-1)*V;return C.value.slice(t,t+V)}),U=t=>{t>=1&&t<=x.value&&(f.value=t)},v=t=>{if(!t)return"";const[s,r,o]=t.split("T")[0].split("-");return`${o}/${r}/${s}`},h=t=>t?Number(t).toLocaleString("es-CL",{minimumFractionDigits:0}):"0",W=()=>{N.visit(route("gastos.create"))},L=t=>{N.visit(route("gastos.edit",t))},S=t=>{confirm("¿Estás seguro de eliminar este gasto?")&&N.delete(route("gastos.destroy",t))},D=t=>{switch(t==null?void 0:t.toLowerCase()){case"pagada":return"bg-green-100 text-green-800 border border-green-300";case"pendiente":return"bg-yellow-100 text-yellow-800 border border-yellow-300";default:return"bg-gray-100 text-gray-800 border border-gray-300"}},z=t=>{switch(t==null?void 0:t.toLowerCase()){case"pagada":return"✅";case"pendiente":return"⏳";default:return"ℹ️"}},F=t=>{U(t)};return(t,s)=>{const r=J("GastoChart");return i(),n(g,null,[k(K(Q),{title:"Gastos"}),k(ee,null,{default:X(()=>[e("main",te,[e("header",se,[s[10]||(s[10]=e("h2",{class:"text-3xl font-bold text-blue-900 flex items-center gap-2 select-none"}," Registro de Gastos ",-1)),e("form",{onSubmit:s[4]||(s[4]=Y(()=>{},["prevent"])),class:"flex flex-wrap gap-4 items-center justify-end w-full sm:w-auto","aria-label":"Filtros de gastos"},[_(e("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>b.value=o),"aria-label":"Filtro por estado",class:"appearance-none w-full sm:w-40 border border-blue-300 rounded-md bg-white px-4 py-2 pr-10 text-sm shadow-md text-blue-800 font-medium focus:outline-none focus:ring-2 focus:ring-blue-200 transition"},s[7]||(s[7]=[e("option",{value:"pendiente"},"⏳ Pendientes",-1),e("option",{value:"pagada"},"✅ Pagadas",-1),e("option",{value:"todas"},"📋 Todas",-1)]),512),[[Z,b.value]]),e("div",oe,[_(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>d.value=o),type:"text",placeholder:"Buscar por Nº Factura...","aria-describedby":"error-factura",class:"border border-blue-300 rounded-md px-3 py-2 text-sm text-blue-800 font-medium focus:outline-none focus:ring-2 focus:ring-blue-200 shadow-md"},null,512),[[E,d.value]]),l.value.facturaFiltro?(i(),n("p",ae,a(l.value.facturaFiltro),1)):j("",!0)]),e("div",le,[s[8]||(s[8]=e("label",{for:"fecha-inicio",class:"text-sm text-blue-800 font-semibold select-none"},"Desde:",-1)),_(e("input",{id:"fecha-inicio","onUpdate:modelValue":s[2]||(s[2]=o=>u.value=o),type:"date",max:c.value||void 0,"aria-describedby":"error-fechas",class:"border border-blue-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200"},null,8,re),[[E,u.value]]),s[9]||(s[9]=e("label",{for:"fecha-fin",class:"text-sm text-blue-800 font-semibold select-none"},"Hasta:",-1)),_(e("input",{id:"fecha-fin","onUpdate:modelValue":s[3]||(s[3]=o=>c.value=o),type:"date",min:u.value||void 0,"aria-describedby":"error-fechas",class:"border border-blue-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200"},null,8,ne),[[E,c.value]])]),l.value.fechas?(i(),n("p",ie,a(l.value.fechas),1)):j("",!0),e("button",{type:"button",onClick:W,class:"bg-blue-800 text-white rounded-lg px-5 py-2 text-sm font-semibold hover:bg-blue-900 shadow-md transition whitespace-nowrap","aria-label":"Crear nuevo gasto"}," ➕ Nuevo Gasto ")],32)]),e("section",de,[k(r,{labels:O.value,data:I.value,title:"Distribución de Gastos por Estado",class:"max-w-md mx-auto sm:max-w-full"},null,8,["labels","data"])]),e("section",ue,[e("table",ce,[s[11]||(s[11]=e("thead",{class:"bg-blue-100 text-blue-900 select-none"},[e("tr",null,[e("th",{class:"px-4 py-3 font-semibold text-left"},"Cotización"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Centro-Barco"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Orden Compra"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Fecha OC"),e("th",{class:"px-4 py-3 font-semibold text-left"},"HES"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Fecha HES"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Valor Neto"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Empresa"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Nº Factura"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Valor Facturado"),e("th",{class:"px-4 py-3 font-semibold text-left"},"Estado"),e("th",{class:"px-4 py-3 font-semibold text-center"},"Acciones")])],-1)),e("tbody",null,[(i(!0),n(g,null,P(G.value,o=>(i(),n("tr",{key:o.id,class:"border-t border-gray-200 hover:bg-blue-50 transition"},[e("td",fe,a(o.cotizacion),1),e("td",pe,a(o.centro_barco),1),e("td",be,a(o.orden_compra),1),e("td",me,a(v(o.fecha_oc)),1),e("td",xe,a(o.hes),1),e("td",ve,a(v(o.fecha_hes)),1),e("td",he,"$"+a(h(o.valor_neto)),1),e("td",ye,a(o.empresa_facturar),1),e("td",_e,a(o.factura),1),e("td",ge,"$"+a(h(o.valor_facturado)),1),e("td",we,[e("span",{class:$([D(o.estado),"px-3 py-1 rounded-full text-xs font-semibold inline-flex items-center gap-1 shadow-sm transition"])},a(z(o.estado))+" "+a(o.estado),3)]),e("td",Ce,[e("button",{onClick:y=>L(o.id),class:"text-blue-600 hover:text-blue-900 font-semibold px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400",title:"Editar gasto","aria-label":"Editar gasto"}," ✏️ ",8,Fe),e("button",{onClick:y=>S(o.id),class:"text-red-600 hover:text-red-900 font-semibold px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400",title:"Eliminar gasto","aria-label":"Eliminar gasto"}," 🗑️ ",8,ke)])]))),128))])])]),e("section",Ee,[(i(!0),n(g,null,P(G.value,o=>(i(),n("article",{key:o.id,class:"bg-white shadow-md rounded-lg p-4 border border-gray-200",role:"listitem",tabindex:"0","aria-label":"Gasto detalle"},[e("h3",Pe,a(o.centro_barco),1),e("dl",$e,[s[12]||(s[12]=e("dt",{class:"font-semibold"},"Cotización:",-1)),e("dd",null,a(o.cotizacion),1),s[13]||(s[13]=e("dt",{class:"font-semibold"},"Orden Compra:",-1)),e("dd",null,a(o.orden_compra),1),s[14]||(s[14]=e("dt",{class:"font-semibold"},"Fecha OC:",-1)),e("dd",null,a(v(o.fecha_oc)),1),s[15]||(s[15]=e("dt",{class:"font-semibold"},"HES:",-1)),e("dd",null,a(o.hes),1),s[16]||(s[16]=e("dt",{class:"font-semibold"},"Fecha HES:",-1)),e("dd",null,a(v(o.fecha_hes)),1),s[17]||(s[17]=e("dt",{class:"font-semibold"},"Valor Neto:",-1)),e("dd",null,"$"+a(h(o.valor_neto)),1),s[18]||(s[18]=e("dt",{class:"font-semibold"},"Valor Facturado:",-1)),e("dd",null,"$"+a(h(o.valor_facturado)),1),s[19]||(s[19]=e("dt",{class:"font-semibold"},"Empresa:",-1)),e("dd",null,a(o.empresa_facturar),1),s[20]||(s[20]=e("dt",{class:"font-semibold"},"Nº Factura:",-1)),e("dd",null,a(o.factura),1),s[21]||(s[21]=e("dt",{class:"font-semibold"},"Estado:",-1)),e("dd",null,[e("span",{class:$([D(o.estado),"px-2 py-1 rounded-full text-xs font-semibold inline-flex items-center gap-1 shadow-sm transition"])},a(z(o.estado))+" "+a(o.estado),3)])]),e("div",Ne,[e("button",{onClick:y=>L(o.id),class:"text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Editar gasto"}," ✏️ Editar ",8,Ve),e("button",{onClick:y=>S(o.id),class:"text-white px-3 py-1 rounded-md text-sm hover:bg-red-600 transition focus:outline-none focus:ring-2 focus:ring-red-400","aria-label":"Eliminar gasto"}," 🗑️ Eliminar ",8,Ae)])]))),128))]),e("nav",Ge,[e("button",{onClick:s[5]||(s[5]=o=>F(f.value-1)),disabled:f.value===1,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed","aria-disabled":"paginaActual === 1","aria-label":"Página anterior"},s[22]||(s[22]=[e("span",{class:"mr-1"},"⬅️",-1),M(" Anterior ")]),8,Le),(i(!0),n(g,null,P(x.value,o=>(i(),n("button",{key:o,onClick:y=>F(o),class:$(["px-3 py-1.5 rounded-md transition min-w-[2.5rem] truncate",o===f.value?"bg-blue-600 text-white":"border border-blue-500 text-blue-600 hover:bg-blue-100"]),"aria-current":"page === paginaActual ? 'page' : false","aria-label":`Ir a la página ${o}`},a(o),11,Se))),128)),e("button",{onClick:s[6]||(s[6]=o=>F(f.value+1)),disabled:f.value===x.value||x.value===0,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed","aria-disabled":"paginaActual === totalPaginas || totalPaginas === 0","aria-label":"Página siguiente"},s[23]||(s[23]=[M(" Siguiente "),e("span",{class:"ml-1"},"➡️",-1)]),8,De)])])]),_:1})],64)}}};export{Be as default};
