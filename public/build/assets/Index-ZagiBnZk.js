import{k as b,r as f,c as n,b as l,f as T,e as s,t as i,l as L,F as v,h as y,n as j,p as F,q as B,s as R,x as E,W as A,y as I,w as M,d as P,g as N,v as V,T as U}from"./app-CQn9PYpG.js";import{A as Y}from"./AppMain-DQAPNrS4.js";import{h as z}from"./html2pdf-CAEuWc8Z.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"p-4 space-y-6 overflow-auto"},W={key:0,class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},H={class:"text-2xl font-bold text-blue-800"},G={id:"calendario-pdf",class:"overflow-x-auto rounded-xl shadow ring-1 ring-blue-200 bg-white p-4"},J={class:"min-w-full border-collapse text-sm text-gray-800"},K={class:"bg-blue-50 border-b border-blue-200 text-xs uppercase sticky top-0 z-10"},Q={class:"px-4 py-2 text-gray-600 semibold whitespace-nowrap"},X={class:"px-4 py-2 text-gray-600 whitespace-nowrap"},Z={class:"px-4 py-2 text-gray-600 whitespace-nowrap"},ee=["title"],te={class:"px-4 py-2 text-center font-bold text-blue-700"},se={class:"mt-8 flex justify-center items-center space-x-1 text-sm sm:text-base font-medium"},ae=["disabled"],oe=["onClick"],le=["disabled"],S=3,ne={__name:"CalendarioAsistencia",props:{trabajadores:Array,mes:Number,a√±o:Number},setup(k){const o=k,x=e=>e.toString().padStart(2,"0"),w=b(()=>{const e=new Date(o.a√±o,o.mes,0);return Array.from({length:e.getDate()},(t,a)=>a+1)}),c=b(()=>new Date(o.a√±o,o.mes-1).toLocaleString("default",{month:"long"}).toUpperCase()),d=e=>({D:"bg-green-100 text-green-800 border-green-300",TR:"bg-blue-100 text-blue-800 border-blue-300",L:"bg-yellow-100 text-yellow-800 border-yellow-300",F:"bg-red-100 text-red-800 border-red-300"})[e]||"bg-gray-100 text-gray-400 border-gray-300",m=(e,t)=>{const a=`${o.a√±o}-${x(o.mes)}-${x(t)}`;return e.asistencias&&e.asistencias[a]?e.asistencias[a]:null},_=e=>w.value.reduce((t,a)=>{const p=`${o.a√±o}-${x(o.mes)}-${x(a)}`;return e&&e[p]==="TR"?t+1:t},0),g=f(!1),C=async()=>{g.value=!0,await B();const e=document.getElementById("calendario-pdf"),t={margin:-.1,filename:`calendario-${new Date().toISOString().slice(0,10)}.pdf`,image:{type:"jpeg",quality:.8},html2canvas:{scale:2,useCORS:!0,backgroundColor:"#fff"},jsPDF:{unit:"in",format:[8.5,16],orientation:"landscape"},pagebreak:{mode:["avoid-all","css","legacy"]}};await z().set(t).from(e).save(),g.value=!1},u=f(1),h=b(()=>Math.ceil(o.trabajadores.length/S)),D=b(()=>{const e=(u.value-1)*S;return o.trabajadores.slice(e,e+S)}),$=b(()=>g.value?o.trabajadores:D.value),r=e=>{e>=1&&e<=h.value&&(u.value=e)};return(e,t)=>(l(),n("div",q,[g.value?T("",!0):(l(),n("div",W,[s("h2",H," üìÖ Calendario de Asistencia - "+i(c.value)+" "+i(k.a√±o),1),s("button",{onClick:C,class:"bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg shadow transition-all"}," üìÑ Exportar PDF ")])),s("div",G,[s("table",J,[s("thead",K,[s("tr",null,[t[2]||(t[2]=s("th",{class:"px-4 py-3 text-left"},"Trabajador",-1)),t[3]||(t[3]=s("th",{class:"px-4 py-3 text-left"},"Cargo",-1)),t[4]||(t[4]=s("th",{class:"px-4 py-3 text-left"},"Embarcaci√≥n",-1)),(l(!0),n(v,null,y(w.value,a=>(l(),n("th",{key:a,class:"px-2 py-3 text-center text-gray-600"},i(a),1))),128)),t[5]||(t[5]=s("th",{class:"px-4 py-3 text-center text-blue-700"},"Total TR",-1))])]),s("tbody",null,[(l(!0),n(v,null,y($.value,a=>(l(),n("tr",{key:a.id,class:"hover:bg-blue-50 transition-colors"},[s("td",Q,i(a.nombre)+", "+i(a.apellido),1),s("td",X,i(a.cargo),1),s("td",Z,i(a.embarcacion),1),(l(!0),n(v,null,y(w.value,p=>(l(),n("td",{key:p,class:"px-1 py-1 text-center"},[s("span",{class:j(["inline-flex items-center justify-center w-6 h-6 rounded-full text-[11px] font-bold border",d(m(a,p))]),title:m(a,p)||"Sin registro"},i(m(a,p)||"-"),11,ee)]))),128)),s("td",te,i(_(a.asistencias)),1)]))),128))])]),t[6]||(t[6]=L('<div class="flex flex-wrap gap-6 mt-6 text-sm font-medium text-gray-700"><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-green-100 border border-green-400"></span> Descanso (D) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-blue-100 border border-blue-400"></span> Trabajo (TR) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-yellow-100 border border-yellow-400"></span> Licencia (L) </div><div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-red-100 border border-red-400"></span> Falta (F) </div></div>',1))]),s("div",se,[s("button",{onClick:t[0]||(t[0]=a=>r(u.value-1)),disabled:u.value===1,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed"},t[7]||(t[7]=[s("span",{class:"mr-1"},"‚¨ÖÔ∏è",-1),F(" Anterior ")]),8,ae),(l(!0),n(v,null,y(h.value,a=>(l(),n("button",{key:a,onClick:p=>r(a),class:j(["px-3 py-1.5 rounded-md transition min-w-[2.5rem]",a===u.value?"bg-blue-600 text-white shadow-md":"border border-blue-300 text-blue-600 hover:bg-blue-100"])},i(a),11,oe))),128)),s("button",{onClick:t[1]||(t[1]=a=>r(u.value+1)),disabled:u.value===h.value,class:"flex items-center px-3 py-1.5 rounded-md border border-blue-500 text-blue-500 hover:bg-blue-100 transition disabled:opacity-50 disabled:cursor-not-allowed"},t[8]||(t[8]=[F(" Siguiente "),s("span",{class:"ml-1"},"‚û°Ô∏è",-1)]),8,le)])]))}},re={class:"px-2 sm:px-4 lg:px-4 space-y-10"},ie={class:"space-y-4"},de={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ce={class:"text-gray-700 text-lg"},ue={class:"text-blue-800 font-semibold"},pe={class:"flex flex-wrap justify-center gap-4"},be=["value"],me=["value"],xe={key:0,class:"flex justify-center py-8"},ge={__name:"Index",setup(k){const{props:o}=R(),x=o.asistencias||[],w=o.trabajadores||[],c=f(o.mes||new Date().getMonth()+1),d=f(o.a√±o||new Date().getFullYear()),m=f(!1),_=f(2024),g=b(()=>{const r=new Date().getFullYear()+1;return Array.from({length:r-_.value+1},(e,t)=>_.value+t)}),C=b(()=>x.filter(({fecha:r})=>{const e=new Date(r);return e.getMonth()+1===c.value&&e.getFullYear()===d.value}).map(({id:r,fecha:e,estado:t,trabajador:a,embarcacion:p})=>({id:r,fecha:e,estado:t,trabajador:a.nombre,cargo:a.cargo,embarcacion:p.nombre}))),u=b(()=>[...w].sort((r,e)=>r.nombre.localeCompare(e.nombre))),h=b(()=>new Date(d.value,c.value-1).toLocaleString("default",{month:"long"}).toUpperCase());E([c,d],async([r,e])=>{m.value=!0,await A.get(route("asistencia.index"),{mes:r,a√±o:e},{preserveScroll:!0,onFinish:()=>m.value=!1})});const D=()=>A.visit(route("asistencia.create")),$=()=>A.visit(route("asistencia.manual"));return(r,e)=>(l(),I(Y,null,{default:M(()=>[s("div",null,[s("div",re,[s("div",ie,[e[3]||(e[3]=s("div",{class:"flex items-center gap-3 text-blue-900"},[s("h1",{class:"text-3xl font-extrabold tracking-tight"},"Asistencia de Trabajadores")],-1)),s("div",de,[s("p",ce,[e[2]||(e[2]=F(" Calendario correspondiente a ")),s("span",ue,i(h.value)+" "+i(d.value),1)]),s("div",{class:"flex flex-wrap gap-3"},[s("button",{onClick:D,class:"inline-flex items-center gap-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," ‚ûï Crear Asistencia "),s("button",{onClick:$,class:"inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white rounded-md px-4 py-2 font-medium shadow-md transition-all"}," üìù Asistencia Manual ")])])]),s("div",pe,[N(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),class:"border border-blue-300 rounded-lg py-2 px-4 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"},[e[4]||(e[4]=s("option",{disabled:"",value:""},"Selecciona un mes",-1)),(l(),n(v,null,y(12,t=>s("option",{key:t,value:t},i(new Date(0,t-1).toLocaleString("default",{month:"long"})),9,be)),64))],512),[[V,c.value]]),N(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t),class:"border border-blue-300 rounded-lg py-2 px-4 text-gray-800 bg-white shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"},[e[5]||(e[5]=s("option",{disabled:"",value:""},"Selecciona un a√±o",-1)),(l(!0),n(v,null,y(g.value,t=>(l(),n("option",{key:t,value:t},i(t),9,me))),128))],512),[[V,d.value]])]),m.value?(l(),n("div",xe,e[6]||(e[6]=[s("svg",{class:"animate-spin h-6 w-6 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1)]))):T("",!0),P(U,{name:"fade",mode:"out-in"},{default:M(()=>[m.value?T("",!0):(l(),n("div",{key:c.value+"-"+d.value,class:"bg-white rounded-xl shadow-lg p-2 ring-1 ring-blue-100 transition-all overflow-x-auto"},[P(ne,{trabajadores:u.value,mes:c.value,a√±o:d.value,asistencias:C.value},null,8,["trabajadores","mes","a√±o","asistencias"])]))]),_:1})])])]),_:1}))}},he=O(ge,[["__scopeId","data-v-b081900c"]]);export{he as default};
